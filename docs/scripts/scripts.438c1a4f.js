!function(){"use strict";angular.module("facetApp",["ui.router","seco.facetedSearch","ngTable","angular.filter","ngAnimate","ui.bootstrap","infinite-scroll"]).constant("_",_).constant("RESULTS_PER_PAGE",25).constant("PAGES_PER_QUERY",1).config(["$urlMatcherFactoryProvider",function(a){a.strictMode(!1)}]).config(["$urlRouterProvider",function(a){a.otherwise("/lista")}]).config(["$stateProvider",function(a){a.state("table",{url:"/taulukko",templateUrl:"views/norssit.table.html",controller:"TableController",controllerAs:"vm"}).state("list",{url:"/lista",templateUrl:"views/norssit.list.html",controller:"CardsController",controllerAs:"vm"}).state("visu",{url:"/visualisointi",templateUrl:"views/norssit.visu.html",controller:"VisuController",controllerAs:"vm"})}])}(),function(){"use strict";function a(a,b,c,d){function e(a){return q.getResults(a,i())}function f(){var b=angular.copy(k);return a.when(b)}function g(){return o}function h(a){var c=b.search().sortBy||"?ordinal";c===a&&b.search("desc",b.search().desc?null:!0),b.search("sortBy",a)}function i(){var a=b.search().sortBy;c.isString(a)||(a="?ordinal");var d;return d=b.search().desc?"DESC("+a+")":a,"?ordinal"===a?d:d+" ?ordinal"}function j(a,c){var d=b.search().sortBy||"?ordinal",e=c?"glyphicon-sort-by-order":"glyphicon-sort-by-alphabet";return d===a?b.search().desc?e+"-alt":e:void 0}this.getResults=e,this.getFacets=f,this.getFacetOptions=g,this.updateSortBy=h,this.getSortClass=j;var k={entryText:{facetId:"entryText",predicate:"<http://ldf.fi/schema/person_registry/entryText>",name:"Haku",enabled:!0},link:{facetId:"link",choices:[{id:"wikipedia",pattern:"?id <http://ldf.fi/norssit/wikipedia> [] .",label:"Wikipedia"},{id:"kansallisbiografia",pattern:"?id <http://ldf.fi/norssit/kansallisbiografia> [] .",label:"Kansallisbiografia"},{id:"kirjasampo",pattern:"?id <http://ldf.fi/norssit/kirjasampo> [] .",label:"Kirjasampo"},{id:"kulttuurisampo",pattern:"?id <http://ldf.fi/norssit/kulttuurisampo> [] .",label:"Kulttuurisampo"},{id:"sotasampo",pattern:"?id <http://ldf.fi/norssit/warsa> [] .",label:"Sotasampo"},{id:"blf",pattern:"?id <http://ldf.fi/norssit/sls_biografi> [] .",label:"BLF"},{id:"wikidata",pattern:"?id <http://ldf.fi/norssit/wikidata> [] .",label:"Wikidata"},{id:"ulan",pattern:"?id <http://ldf.fi/norssit/ulan> [] .",label:"ULAN"},{id:"viaf",pattern:"?id <http://ldf.fi/norssit/viaf> [] .",label:"VIAF"},{id:"genicom",pattern:"?id <http://ldf.fi/norssit/genicom> [] .",label:"Geni.com"}],enabled:!0,name:"Linkit"},familyName:{facetId:"familyName",predicate:"<http://schema.org/familyName>",name:"Sukunimi"},birthPlace:{facetId:"birthPlace",predicate:"<http://ldf.fi/schema/person_registry/birthPlace>",name:"Syntymäpaikka",enabled:!0},enrollmentYear:{facetId:"enrollmentYear",predicate:"<http://ldf.fi/schema/person_registry/enrollmentYear>",name:"Aloittamisvuosi",enabled:!0},matriculationYear:{facetId:"matriculationYear",predicate:"<http://ldf.fi/schema/person_registry/matriculationYear>",name:"Valmistumisvuosi",enabled:!0},occupation:{facetId:"occupation",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/a",name:"Arvo tai ammatti",enabled:!0},education:{facetId:"education",predicate:"^<http://ldf.fi/schema/bioc/education_inheres_in>/a",name:"Koulutus",enabled:!0},organization:{facetId:"organization",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/<http://ldf.fi/schema/bioc/relates_to>",name:"Työpaikka tai oppilaitos",enabled:!0},hobby:{facetId:"hobby",predicate:"<http://schema.org/hobby>",name:"Harrastus"},medal:{facetId:"medal",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/<http://ldf.fi/schema/bioc/relates_to_medal>",name:"Kunniamerkit ja -mitalit",enabled:!0},rank:{facetId:"rank",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/<http://ldf.fi/schema/bioc/relates_to_rank>",name:"Sotilasarvo tai -toimi",enabled:!0}},l=" PREFIX hobbies: <http://ldf.fi/hobbies/>  PREFIX norssit: <http://ldf.fi/norssit/>  PREFIX nach: <http://ldf.fi/norssit/achievements/>  PREFIX owl: <http://www.w3.org/2002/07/owl#>  PREFIX person_registry: <http://ldf.fi/schema/person_registry/>  PREFIX places: <http://ldf.fi/places/>  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  PREFIX relatives: <http://ldf.fi/relatives/>  PREFIX schema: <http://schema.org/>  PREFIX schemax: <http://topbraid.org/schemax/>  PREFIX dct: <http://purl.org/dc/terms/>  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>  PREFIX xml: <http://www.w3.org/XML/1998/namespace>  PREFIX bioc: <http://ldf.fi/schema/bioc/>  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> ",m=' SELECT DISTINCT * WHERE {  {     <RESULT_SET>   }   OPTIONAL { ?id schema:givenName ?givenName . }  OPTIONAL { ?id schema:familyName ?familyName . }  OPTIONAL { ?id person_registry:birthPlace ?birthPlace . }   OPTIONAL { ?id norssit:ordinal ?ordinal . }   OPTIONAL { ?id norssit:register_id ?registerNumber . }   OPTIONAL { ?id schema:birthDate ?birthDate . }  OPTIONAL { ?id schema:deathDate ?deathDate . }  OPTIONAL {    ?id schema:hobby ?hobby_id .    BIND(REPLACE(STR(?hobby_id), "http://ldf.fi/hobbies/", "") AS ?hobby)   }  OPTIONAL { ?id schema:image ?image . }  OPTIONAL { ?id dct:description ?description . }  OPTIONAL { ?id person_registry:pageNumber ?pageNumber . }  OPTIONAL { ?id person_registry:pageImageURL ?pageImageURL . }  OPTIONAL { ?id person_registry:relatedNorssi ?relatedNorssi . }  OPTIONAL { ?id person_registry:enrollmentYear ?enrollmentYear . }  OPTIONAL { ?id person_registry:matriculationYear ?matriculationYear . }  OPTIONAL { ?id person_registry:entryText ?entryText . }  OPTIONAL { ?id norssit:wikipedia ?wikipedia . }  OPTIONAL { ?id norssit:viaf ?viaf . }  OPTIONAL { ?id norssit:kansallisbiografia ?kansallisbiografia . }  OPTIONAL { ?id norssit:wikidata ?wikidata . }  OPTIONAL { ?id norssit:ulan ?ulan . }  OPTIONAL { ?id norssit:warsa ?warsa . }  OPTIONAL { ?id norssit:kirjasampo ?kirjasampo . }  OPTIONAL { ?id norssit:kulttuurisampo ?kulttuurisampo . }  OPTIONAL { ?id norssit:kb ?kb . }  OPTIONAL { ?id norssit:genitree ?genitree . }  OPTIONAL { ?id norssit:genicom ?genicom . }  OPTIONAL { ?id norssit:sls_biografi ?blf . }  OPTIONAL { ?id ^bioc:title_inheres_in/a/skos:prefLabel ?occupation . }  OPTIONAL { ?id ^bioc:title_inheres_in/bioc:relates_to/skos:prefLabel ?organization . }  OPTIONAL {   	?id bioc:has_family_relation [    	bioc:inheres_in ?relative__id ;      	a/skos:prefLabel ?relative__type ] .    	FILTER (LANG(?relative__type)="fi")    	?relative__id schema:familyName ?relative__familyName ; schema:givenName ?relative__givenName .		BIND (replace(concat(?relative__givenName," ",?relative__familyName),"[(][^)]+[)]s*","") AS ?relative__name)   }  OPTIONAL {     ?ach rdfs:subPropertyOf* nach:involved_in .    ?id ?ach ?achievement__id .     ?achievement__id skos:prefLabel ?achievement__label .    ?achievement__id norssit:wikipedia|norssit:www ?achievement__wikipedia .  } }',n="https://ldf.fi/norssit/sparql",o={endpointUrl:n,rdfClass:"<http://xmlns.com/foaf/0.1/Person>",constraint:"?id <http://ldf.fi/norssit/ordinal> ?ordinal . ?id <http://schema.org/familyName> ?familyName .",preferredLang:"fi"},p={queryTemplate:m,prefixes:l,pagesPerQuery:2},q=new d(n,p)}angular.module("facetApp").service("norssitService",a),a.$inject=["$q","$location","_","FacetResultHandler"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a){var b=o.replace("<RESULT_SET>",a.constraint.join(" "));return u.getObjectsNoGrouping(b)}function g(a){var b=a.constraint.join(" ");return u.getObjectsNoGrouping(p.replace("<RESULT_SET>",b))}function h(a){return u.getObjectsNoGrouping(q.replace(/<RESULT_SET>/g,a.constraint.join(" ")))}function i(a){return u.getObjectsNoGrouping(r.replace(/<RESULT_SET>/g,a.constraint.join(" ")))}function j(b){var c=[this.getResults1(b),this.getResults2(b),this.getResultsTopTitles(b),this.getResultsTopOrgs(b)];return a.all(c)}function k(){var b=angular.copy(m);return a.when(b)}function l(){return t}this.getResults=j,this.getResults1=f,this.getResults2=g,this.getResultsTopTitles=h,this.getResultsTopOrgs=i,this.getFacets=k,this.getFacetOptions=l;var m={entryText:{facetId:"entryText",predicate:"<http://ldf.fi/schema/person_registry/entryText>",name:"Haku",enabled:!0},link:{facetId:"link",choices:[{id:"wikipedia",pattern:"?id <http://ldf.fi/norssit/wikipedia> [] .",label:"Wikipedia"},{id:"kansallisbiografia",pattern:"?id <http://ldf.fi/norssit/kansallisbiografia> [] .",label:"Kansallisbiografia"},{id:"kirjasampo",pattern:"?id <http://ldf.fi/norssit/kirjasampo> [] .",label:"Kirjasampo"},{id:"kulttuurisampo",pattern:"?id <http://ldf.fi/norssit/kulttuurisampo> [] .",label:"Kulttuurisampo"},{id:"sotasampo",pattern:"?id <http://ldf.fi/norssit/warsa> [] .",label:"Sotasampo"},{id:"blf",pattern:"?id <http://ldf.fi/norssit/sls_biografi> [] .",label:"BLF"},{id:"wikidata",pattern:"?id <http://ldf.fi/norssit/wikidata> [] .",label:"Wikidata"},{id:"ulan",pattern:"?id <http://ldf.fi/norssit/ulan> [] .",label:"ULAN"},{id:"viaf",pattern:"?id <http://ldf.fi/norssit/viaf> [] .",label:"VIAF"},{id:"genicom",pattern:"?id <http://ldf.fi/norssit/genicom> [] .",label:"Geni.com"}],enabled:!0,name:"Linkit"},familyName:{facetId:"familyName",predicate:"<http://schema.org/familyName>",name:"Sukunimi"},birthPlace:{facetId:"birthPlace",predicate:"<http://ldf.fi/schema/person_registry/birthPlace>",name:"Syntymäpaikka",enabled:!0},enrollmentYear:{facetId:"enrollmentYear",predicate:"<http://ldf.fi/schema/person_registry/enrollmentYear>",name:"Aloittamisvuosi",enabled:!0},matriculationYear:{facetId:"matriculationYear",predicate:"<http://ldf.fi/schema/person_registry/matriculationYear>",name:"Valmistumisvuosi",enabled:!0},occupation:{facetId:"occupation",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/a",name:"Arvo tai ammatti",enabled:!0},education:{facetId:"education",predicate:"^<http://ldf.fi/schema/bioc/education_inheres_in>/a",name:"Koulutus",enabled:!0},organization:{facetId:"organization",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/<http://ldf.fi/schema/bioc/relates_to>",name:"Työpaikka tai oppilaitos",enabled:!0},hobby:{facetId:"hobby",predicate:"<http://schema.org/hobby>",name:"Harrastus"},medal:{facetId:"medal",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/<http://ldf.fi/schema/bioc/relates_to_medal>",name:"Kunniamerkit ja -mitalit",enabled:!0},rank:{facetId:"rank",predicate:"^<http://ldf.fi/schema/bioc/title_inheres_in>/<http://ldf.fi/schema/bioc/relates_to_rank>",name:"Sotilasarvo tai -toimi",enabled:!0}},n=" PREFIX hobbies: <http://ldf.fi/hobbies/>  PREFIX norssit: <http://ldf.fi/norssit/>  PREFIX nach: <http://ldf.fi/norssit/achievements/>  PREFIX owl: <http://www.w3.org/2002/07/owl#>  PREFIX person_registry: <http://ldf.fi/schema/person_registry/>  PREFIX places: <http://ldf.fi/places/>  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  PREFIX relatives: <http://ldf.fi/relatives/>  PREFIX schema: <http://schema.org/>  PREFIX schemax: <http://topbraid.org/schemax/>  PREFIX dct: <http://purl.org/dc/terms/>  PREFIX foaf: <http://xmlns.com/foaf/0.1/>  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>  PREFIX xml: <http://www.w3.org/XML/1998/namespace>  PREFIX bioc: <http://ldf.fi/schema/bioc/>  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> ",o=n+"  SELECT distinct ?occupation ?education ?organization ?id   WHERE {  	 { <RESULT_SET> }   	 ?evt bioc:education_inheres_in|bioc:title_inheres_in ?id .     OPTIONAL { ?evt bioc:title_inheres_in ?id ; a/skos:prefLabel ?occupation . }    OPTIONAL { ?evt bioc:education_inheres_in ?id ; a/skos:prefLabel ?education . }    OPTIONAL { ?evt bioc:relates_to/skos:prefLabel ?organization . }  } ",p=n+"  SELECT ?enrollmentYear ?matriculationYear   WHERE {  	 { <RESULT_SET> }     OPTIONAL { ?id person_registry:enrollmentYear ?enrollmentYear . }    OPTIONAL { ?id person_registry:matriculationYear ?matriculationYear . }  } ",q=n+"  SELECT ?label ?year (count (distinct ?id) AS ?count)    WHERE {     {     SELECT ?class (count (distinct ?id) AS ?no)     WHERE {       ?class rdfs:subClassOf+ bioc:Title .       ?evt a ?class ;            bioc:title_inheres_in ?id .         { <RESULT_SET> }     } GROUP BY ?class ORDER BY desc(?no) LIMIT 5     }     ?class skos:prefLabel ?label .     ?evt a ?class ;          bioc:title_inheres_in ?id ;          schema:startDate ?year .     { <RESULT_SET> }   } GROUP BY ?label ?year ORDER by ?year ",r=n+"  SELECT ?label ?year (count (distinct ?id) AS ?count)    WHERE {     {     SELECT ?org (count (distinct ?id) AS ?no)     WHERE {       ?evt bioc:education_inheres_in|bioc:title_inheres_in ?id ;            bioc:relates_to ?org .         { ?id <http://ldf.fi/norssit/wikipedia> [] .  ?id a <http://xmlns.com/foaf/0.1/Person> .  }     } GROUP BY ?org ORDER BY desc(?no) LIMIT 5     }     ?org skos:prefLabel ?label .     ?evt a ?class ;          bioc:education_inheres_in|bioc:title_inheres_in ?id ;            bioc:relates_to ?org;          schema:startDate ?year .     { ?id <http://ldf.fi/norssit/wikipedia> [] .  ?id a <http://xmlns.com/foaf/0.1/Person> .  }   } GROUP BY ?label ?year ORDER by ?year ",s="https://ldf.fi/norssit/sparql",t={endpointUrl:s,rdfClass:"<http://xmlns.com/foaf/0.1/Person>",preferredLang:"fi"},u=new d(s,e)}angular.module("facetApp").service("norssitVisuService",a),a.$inject=["$q","$location","_","AdvancedSparqlService","objectMapperService"]}(),function(){"use strict";function a(a,b,c){function d(c,d){return a("navbar-fi.html").then(function(b){return d.html(b),a("views/subnavbar.html")}).then(function(a){return angular.element("#subnav").html(a),b(d.contents())(c)})}function e(){function a(){c.open({templateUrl:"views/help.html",size:"lg"})}var b=this;b.showHelp=a}return{link:d,controller:e,controllerAs:"vm"}}angular.module("facetApp").directive("wsNavbar",a),a.$inject=["$templateRequest","$compile","$uibModal"]}(),function(){"use strict";function a(a){function b(){return a.$close()}function c(a,b,c){return a.replace(""+b,""+(b+c))}function d(a){g.pageUrl=c(g.pageUrl,g.pageNo,a),g.pageNo=g.pageNo+a}function e(){return d(1)}function f(){return d(-1)}var g=this;g.close=b,g.nextPage=e,g.previousPage=f,g.$onInit=function(){g.person=g.resolve.person,g.pageUrl=g.resolve.person.pageImageURL,g.pageNo=parseInt(g.resolve.person.pageNumber)}}angular.module("facetApp").component("registerPageModal",{templateUrl:"views/page-modal.html",controller:a,bindings:{resolve:"<",close:"&",dismiss:"&"}}),a.$inject=["$scope"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a){return d.castArray(a)}function k(){b.reload()}function l(){s.tableParams=new g({count:e},{getData:o})}function m(a){c.open({component:"registerPageModal",size:"lg",resolve:{person:function(){return a}}})}function n(){var a=f.getFacetOptions();return a.initialState=i.getFacetValuesFromUrlParams(),a}function o(a){return s.isLoadingResults=!0,s.pager.getPage(a.page()-1,a.count()).then(function(a){return s.pager.getTotalCount().then(function(b){return s.tableParams.total(b),a}).then(function(a){return s.isLoadingResults=!1,a})})}function p(a,b){return i.updateUrlParams(b),s.previousSelections=d.clone(b.constraint),q(b)}function q(a){s.isLoadingResults=!0,f.getResults(a).then(function(a){s.pager=a,s.tableParams?(s.tableParams.page(1),s.tableParams.reload()):l()})}function r(a){return f.updateSortBy(a),q({constraint:s.previousSelections})}var s=this;s.openPage=m,s.toArray=j,s.removeFacetSelections=k,s.sortBy=r,s.getSortClass=f.getSortClass;var t=a.$on("sf-initial-constraints",function(a,b){p(a,b),t()});a.$on("sf-facet-constraints",p),f.getFacets().then(function(b){s.facets=b,s.facetOptions=n(),s.facetOptions.scope=a,s.handler=new h(s.facetOptions)})}angular.module("facetApp").controller("TableController",a),a.$inject=["$scope","$state","$uibModal","_","RESULTS_PER_PAGE","norssitService","NgTableParams","FacetHandler","facetUrlStateHandlerService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a){return e.castArray(a)}function j(){c.reload()}function k(a){d.open({component:"registerPageModal",size:"lg",resolve:{person:function(){return a}}})}function l(){var a=f.getFacetOptions();return a.initialState=h.getFacetValuesFromUrlParams(),a}function m(){var a=e.uniqueId();w=a,u.isLoadingResults=!0,s++<=t?u.pager.getPage(s-1,24).then(function(b){a===w&&(u.people=u.people.concat(b),u.isLoadingResults=!1)})["catch"](r):u.isLoadingResults=!1}function n(){return u.isLoadingResults||s>t}function o(a){return f.updateSortBy(a),q({constraint:u.previousSelections})}function p(a,b){return u.previousSelections&&e.isEqual(b.constraint,u.previousSelections)?void 0:(u.previousSelections=e.clone(b.constraint),h.updateUrlParams(b),q(b))}function q(a){u.isLoadingResults=!0,u.people=[],u.error=void 0;var b=e.uniqueId();x=b,s=0,f.getResults(a).then(function(a){return a.getMaxPageNo().then(function(b){return[a,b]})}).then(function(a){return x===b?(u.pager=a[0],t=a[1],u.isLoadingResults=!1,m()):void 0})["catch"](r)}function r(a){u.isLoadingResults=!1,u.error=a}var s,t,u=this;u.openPage=k,u.toArray=i,u.nextPage=m,u.isScrollDisabled=n,u.removeFacetSelections=j,u.sortBy=o,u.getSortClass=f.getSortClass,u.people=[];var v=a.$on("sf-initial-constraints",function(a,b){p(a,b),v()});a.$on("sf-facet-constraints",p),f.getFacets().then(function(b){u.facets=b,u.facetOptions=l(),u.facetOptions.scope=a,u.handler=new g(u.facetOptions)});var w,x}angular.module("facetApp").controller("CardsController",a),a.$inject=["$scope","$location","$state","$uibModal","_","norssitService","FacetHandler","facetUrlStateHandlerService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){d.reload()}function j(){var a=f.getFacetOptions();return a.initialState=h.getFacetValuesFromUrlParams(),a}function k(a,b){return u.previousSelections&&e.isEqual(b.constraint,u.previousSelections)?void 0:(u.previousSelections=e.clone(b.constraint),h.updateUrlParams(b),s(b).then(function(a){google.charts.setOnLoadCallback(o),google.charts.setOnLoadCallback(function(){m("occupation","Arvo tai ammatti","chart_occupation")}),google.charts.setOnLoadCallback(function(){m("organization","Työpaikka tai oppilaitos","chart_organization")}),google.charts.setOnLoadCallback(function(){m("education","Koulutus","chart_education")}),google.charts.setOnLoadCallback(function(){n("enrollmentYear","Aloitusvuosi","chart_enrollmentYear")}),google.charts.setOnLoadCallback(function(){n("matriculationYear","Valmistumisvuosi","chart_matriculationYear")}),google.charts.setOnLoadCallback(function(){l(u.topTitles,"Viisi yleisintä virkaa vuosikymmenittäin","chart_topeducation")}),google.charts.setOnLoadCallback(function(){l(u.topOrgs,"Viisi suosituinta organisaatiota vuosikymmenittäin","chart_toporganization")})}))}function l(a,b,c){var d=10,e={};$.each(a,function(a,b){if(b.hasOwnProperty("label")){var c=b.label;e.hasOwnProperty(c)||(e[c]={}),e[c][b.year]=b.count}});var a=new google.visualization.DataTable;a.addColumn("number","X");var f={},g=1;$.each(e,function(b,c){a.addColumn("number",b),$.each(c,function(a,b){var c=Math.floor(parseInt(a)/d)*d;f.hasOwnProperty(c)||(f[c]=[parseInt(c),0,0,0,0,0]),f[c][g]+=parseInt(b)}),g++}),f=$.map(f,function(a,b){return[a]}),a.addRows(f);var h={title:b,hAxis:{title:"Vuosikymmen"},vAxis:{title:"Henkilöä"}},i=new google.visualization.ColumnChart(document.getElementById(c));i.draw(a,h)}function m(a,b,c){var d=p(u.people,a),e=google.visualization.arrayToDataTable([[b,"Lukumäärä"]].concat(d)),f={title:b},g=new google.visualization.PieChart(document.getElementById(c));g.draw(e,f)}function n(a,b,c){var d=new google.visualization.DataTable,e={title:b,legend:{position:"none"},colors:["green"],histogram:{bucketSize:1,hideBucketItems:!0,maxNumBuckets:150},hAxis:{slantedText:!1,maxAlternation:1,format:""},width:"95%",height:500},f=new google.visualization.Histogram(document.getElementById(c));d.addColumn("number"),d.addRows(q(u.years,a)),f.draw(d,e)}function o(){var a="education",b="organization",c={},d={},e=10;$.each(u.people,function(e,f){if(f.hasOwnProperty(a)&&f.hasOwnProperty(b)){var g=f[a],h=f[b];c.hasOwnProperty(g)?c[g]+=1:c[g]=1,d.hasOwnProperty(h)?d[h]+=1:d[h]=1}}),c=$.map(c,function(a,b){return[[b,a]]}).sort(function(a,b){return b[1]-a[1]}),d=$.map(d,function(a,b){return[[b,a]]}).sort(function(a,b){return b[1]-a[1]});var f={},g={};$.each(c,function(a,b){f[b[0]]={index:e-1>a?a:e-1}}),$.each(d,function(a,b){g[b[0]]={index:e-1>a?a:e-1}});var h=$.map(new Array(Math.min(e,c.length)),function(a,b){return[$.map(new Array(Math.min(e,d.length)),function(a,b){return 0})]});$.each(u.people,function(c,d){if(d.hasOwnProperty(a)&&d.hasOwnProperty(b)){var e=d[a],i=d[b];h[f[e].index][g[i].index]+=1}});for(var i=[],j=0;j<h.length;j++)for(var k=0;k<h[j].length;k++)i.push([e-1>k?d[k][0]:"muu laitos",e-1>j?c[j][0]:"muu arvo",h[j][k]]);var l=new google.visualization.DataTable;l.addColumn("string",b),l.addColumn("string",a),l.addColumn("number","Weight"),l.addRows(i);var m={title:"Otsikko",sankey:{node:{label:{fontSize:14,color:"#000",bold:!0},labelPadding:12}}},n=new google.visualization.Sankey(document.getElementById("chart_sankey"));n.draw(l,m)}function p(a,b){return r(a,b).sort(function(a,b){return b[1]-a[1]})}function q(a,b){var c=[];return $.each(a,function(a,d){d.hasOwnProperty(b)&&c.push([parseInt(d[b])])}),c}function r(a,b){var c={};return $.each(a,function(a,d){if(d.hasOwnProperty(b)){var e=d[b];c.hasOwnProperty(e)?c[e]+=1:c[e]=1}}),$.map(c,function(a,b){return[[b,a]]})}function s(a){u.isLoadingResults=!0,u.people=[],u.years=[],u.topTitles=[],u.topOrgs=[],u.error=void 0;var b=e.uniqueId();return w=b,f.getResults(a).then(function(a){return w===b?(u.isLoadingResults=!1,u.people=a[0],u.years=a[1],u.topTitles=a[2],u.topOrgs=a[3],a):void 0})["catch"](t)}function t(a){console.log(a),u.isLoadingResults=!1,u.error=a}var u=this;u.people=[],u.startYear=[],u.topTitles=[],u.topOrgs=[],u.removeFacetSelections=i,google.charts.load("current",{packages:["corechart","line","sankey"]});var v=a.$on("sf-initial-constraints",function(a,b){k(a,b),v()});a.$on("sf-facet-constraints",k),f.getFacets().then(function(b){u.facets=b,u.facetOptions=j(),u.facetOptions.scope=a,u.handler=new g(u.facetOptions)});var w}angular.module("facetApp").controller("VisuController",a),a.$inject=["$scope","$location","$q","$state","_","norssitVisuService","FacetHandler","facetUrlStateHandlerService"]}(),angular.module("facetApp").run(["$templateCache",function(a){"use strict";a.put("views/achievements-popover.html",'<div class="achievement-list"> <ul class="list-unstyled"> <li ng-repeat="achievement in vm.toArray(person.achievement)"><a ng-href="{{ achievement.wikipedia }}">{{ achievement.label }}</a></li> </ul> </div>'),a.put("views/help.html",'<div class="modal-header"> <div class="row"> <div class="col-xs-10 text-left"> <h3 class="modal-title">Norssit</h3> </div> <div class="col-xs-2"> <a href="#" ng-click="$close()" class="no-decoration btn-lg pull-right glyphicon glyphicon-remove"></a> </div> </div> </div> <div class="modal-body"> <p> Matrikkelin tietoja voi selata käyttöliittymässä käyttämällä vasemmalla olevia suodattimia. Hakeaksesi rekisterillä tekstihaulla, kirjoita haku \'Haku\'-kenttään. Poistaaksesi hakurajauksen, paina X-nappia hakukentän oikealla puolella. Jokaisella suodattimella on oma hakukenttä sekä lista suodattimen vaihtoehdoista, josta voi valita haluamansa ehdon. Tulosten määrä vaihtoehdolla näkyy suluissa valinnan nimen perässä. Valinnan voi poistaa valitsemalla vaihtoehdon \'-- No Selection --\'. Jokaisesta suodattimesta voi valita vain yhden vaihtoehdon, jolloin henkilölistausta suodatetaan valintojen perusteella. Tuloslistaa voi suodattaa käyttäen eri suodattimia yhdessä. </p> <p> <h4>Suodattimien valinta:</h4> <ol> <li>Valitse joku suodattimista ja avaa suodatin painamalla \'+\'-nappia suodattimen otsikon oikealla puolella.</li> <li>Valitse suodattimeen arvo listalta tai hae kirjoittamalla listan yllä olevaan tekstikenttään. Jos suodatinehtoa haetaan tekstikentän avulla alla oleva lista suodattimista päivittyy kirjoittaessa.</li> <li>Suodatinehdon voi valita klikkaamalla sitä listalta, tai poistaa valitsemalla \'-- No Selection --\' listan alusta. </li> <li>Henkilöiden lista päivittyy suodattimien oikealla puolella.</li> <li>Tuloksia voi nyt suodattaa tarvittaessa lisää toistamalla toisella suodattimella edelliset askeleet 1-4.</li> </ol> </p> </div>'),a.put("views/norssit.description.partial.html",'<h1>Vanhat Norssit semanttisessa webissä</h1> <p> Norssimatrikkelihaku. Voit rajata tulosta tekemällä valintoja suodattimista ja selata henkilöihin liittyvää tietoa linkkien kautta. Lähde: <a href="http://www.norssit.fi/matrikkeli_1867-1992.html">Helsingin Norssin matrikkeli 1867-1992</a> </p>'),a.put("views/norssit.facets.partial.html",'<a href="" ng-click="vm.removeFacetSelections()">Poista kaikki valinnat</a> <div class="facets"> <seco-text-facet data-options="vm.facets.entryText"></seco-text-facet> <div class="show-facets row"> <div class="col-xs-12"> <button class="btn btn-default pull-right visible-xs-block visible-sm-block" ng-click="show = !show">{{ show ? \'Piilota fasetit\' : \'Näytä fasetit\' }}</button> </div> </div> <div class="hideable-facets" ng-class="{ \'hidden-sm hidden-xs\': !show }"> <seco-checkbox-facet data-options="vm.facets.link"></seco-checkbox-facet> <seco-basic-facet data-options="vm.facets.occupation"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.education"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.organization"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.familyName"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.hobby"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.birthPlace"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.enrollmentYear"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.matriculationYear"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.medal"></seco-basic-facet> <seco-basic-facet data-options="vm.facets.rank"></seco-basic-facet> </div> </div>'),a.put("views/norssit.list.html",'<div class="container-fluid"> <div class="row"> <div class="col-md-1 col-sm-2 col-xs-2 vcenter push-xs-2"> <img src="http://www.norssit.fi/images/norssi_logo.jpg" class="norssi-logo center-block img img-responsive"> </div><!-- DO NOT REMOVE THIS COMMENT, IT IS A HACK\n --><div class="col-xs-9 col-md-8 col-lg-9 vcenter push-xs-9"> <div ng-include="\'views/norssit.description.partial.html\'"></div> </div> <div class="col-md-3 pull-md-3 col-lg-2"> <div ng-include="\'views/norssit.facets.partial.html\'"></div> </div> <div class="col-md-9 col-lg-10"> <b>Järjestä:</b> <span class="sort"> <a href="" ng-click="vm.sortBy(\'?ordinal\')">Matrikkelijärjestys</a> <span ng-class="vm.getSortClass(\'?ordinal\', true)" class="glyphicon" aria-hidden="true"></span> </span> <span class="sort"> <a href="" ng-click="vm.sortBy(\'?familyName\')">Sukunimi</a> <span ng-class="vm.getSortClass(\'?familyName\')" class="glyphicon" aria-hidden="true"></span> </span> <div ng-include="\'views/norssit.list.partial.html\'"></div> </div> </div> </div>'),a.put("views/norssit.list.partial.html",'<img class="loading-img" src="images/loading-lg.7ba320e0.gif" ng-if="vm.isLoadingResults"> <div infinite-scroll="vm.nextPage()" infinite-scroll-disabled="vm.isScrollDisabled()" infinite-scroll-distance="0"> <div class="row"> <div ng-repeat="person in vm.people" class="person-container"> <div class="col-xs-12 col-sm-12 person-panel col-md-4 col-lg-3"> <div class="thumbnail" ng-mouseenter="enlarge = true" ng-mouseleave="enlarge = false"> <div class="person-profile-img vertical-center"> <img class="img img-responsive center-block media-middle" ng-src="{{ ::(vm.toArray(person.image) | first) || \'images/person_placeholder.cd371769.svg\' }}"> </div> <div class="caption"> <div class="visible-caption"> <div class="row"> <div class="col-xs-12 col-sm-3 col-md-12"> <b>{{ ::person.registerNumber }}. {{ ::person.givenName }} {{ ::person.familyName }}</b> </div> <div class="col-xs-12 col-sm-9 col-md-12"> <p ng-if="::(person.birthPlace || person.birthDate || person.deathDate)"> &#8727;&nbsp;<span ng-if="::person.birthPlace">{{ ::person.birthPlace }}</span> {{ ::person.birthDate || \'?\' | date:\'dd.MM.yyyy\' }} <span ng-if="::person.deathDate">&dagger;&nbsp;{{ ::person.deathDate | date:\'dd.MM.yyyy\' }}</span> </p> </div> <div class="col-xs-12"> <p>Norssi {{ ::person.enrollmentYear || \'?\' }} - {{ ::person.matriculationYear || \'?\' }}</p> </div> <div ng-if="::person.occupation" class="col-xs-12"> <p>{{ ::vm.toArray(person.occupation) | join:\', \' }}</p> </div> <div class="col-xs-12 icon-menu"> <a title="Näytä matrikkeliteksti" ng-attr-title="{{ showText ? \'Piilota matrikkeliteksti\' : \'Näytä matrikkeliteksti\' }}" href="" ng-click="showText = !showText"><span class="glyphicon" ng-class="{ \'glyphicon-collapse-down\': !showText, \'glyphicon-collapse-up\': showText }" aria-hidden="true"></span></a> <a title="Avaa matrikkelisivu" href="" ng-click="::vm.openPage(person)"><span class="glyphicon glyphicon-book" aria-hidden="true"></span></a> <a title="Data" class="" ng-href="{{ ::person.id }}"><span class="glyphicon glyphicon-hdd" aria-hidden="true"></span></a> </div> </div> <div class="row"> <div ng-if="::person.achievement" class="col-xs-6"> <a href="" class="link" uib-popover-template="\'views/achievements-popover.html\'" popover-trigger="\'outsideClick\'" popover-append-to-body="true" popover-placement="auto right">Saavutukset</a> </div> <div ng-if="::person.wikipedia" class="col-xs-6"> <a ng-href="{{ ::person.wikipedia }}">Wikipedia</a> </div> <div ng-if="::person.kansallisbiografia" class="col-xs-6"> <a ng-href="{{ ::person.kansallisbiografia }}">Kansallisbiografia</a> </div> <div ng-if="::person.warsa" class="col-xs-6"> <a ng-href="http://www.sotasampo.fi/fi/persons/?uri={{ ::person.warsa }}">Sotasampo</a> </div> <div ng-if="::person.kirjasampo" class="col-xs-6"> <a ng-href="{{ ::person.kirjasampo }}">Kirjasampo</a> </div> <div ng-if="::person.kulttuurisampo" class="col-xs-6"> <a ng-href="{{ ::person.kulttuurisampo }}">Kulttuurisampo</a> </div> <div ng-if="::person.blf" class="col-xs-6"> <a ng-href="{{ ::person.blf }}">BLF</a> </div> <div ng-if="::person.ulan" class="col-xs-6"> <a ng-href="{{ ::person.ulan }}">ULAN</a> </div> <div ng-if="::person.viaf" class="col-xs-6"> <a ng-href="{{ ::person.viaf }}">VIAF</a> </div> <div ng-if="::person.genicom" class="col-xs-6"> <a ng-href="{{ ::person.genicom }}">Kotisivu (Geni.com)</a> </div> <div ng-if="::person.genitree" class="col-xs-6"> <a ng-href="{{ ::person.genitree }}">Sukupuu (Geni.com)</a> </div> </div> <div ng-if="::person.relative" class="row"> <div class="col-xs-12">Sukulaisnorssit:</div> <div class="col-sm-6 col-md-12" ng-repeat="relative in vm.toArray(person.relative)"> {{ ::relative.type }}<a ng-href="{{ ::relative.id }}"> {{ ::relative.name }}</a> </div> </div> <div ng-if="::person.hobby" class="row"> <div class="col-md-12"> <p>Harrastukset: {{ ::vm.toArray(person.hobby) | join: \', \' }}</p> </div> </div> <div uib-collapse="!showText"> <hr> <p>{{ ::person.entryText }}</p> </div> </div> </div> </div> </div> <div class="clearfix visible-lg-block" ng-if="($index + 1) % 4 == 0"></div> <div class="clearfix visible-md-block" ng-if="($index + 1) % 3 == 0"></div> <div class="clearfix visible-sm-block" ng-if="($index + 1) % 1 == 0"></div> <div class="clearfix visible-xs-block" ng-if="($index + 1) % 1 == 0"></div> </div> </div> </div>'),a.put("views/norssit.table.html",'<div class="container-fluid"> <div class="row"> <div class="col-md-1 col-sm-2 col-xs-2 vcenter push-xs-2"> <img src="http://www.norssit.fi/images/norssi_logo.jpg" class="norssi-logo center-block img img-responsive"> </div><!-- DO NOT REMOVE THIS COMMENT, IT IS A HACK\n --><div class="col-xs-9 col-md-8 col-lg-9 vcenter push-xs-9"> <div ng-include="\'views/norssit.description.partial.html\'"></div> </div> <div class="col-md-3 pull-md-3 col-lg-2"> <div ng-include="\'views/norssit.facets.partial.html\'"></div> </div> <div class="col-md-9 col-lg-10"> Järjestä: <span class="sort"> <a href="" ng-click="vm.sortBy(\'?ordinal\')">Matrikkelijärjestys</a> <span ng-class="vm.getSortClass(\'?ordinal\', true)" class="glyphicon" aria-hidden="true"></span> </span> <span class="sort"> <a href="" ng-click="vm.sortBy(\'?familyName\')">Sukunimi</a> <span ng-class="vm.getSortClass(\'?familyName\')" class="glyphicon" aria-hidden="true"></span> </span> <div ng-include="\'views/norssit.table.partial.html\'"></div> </div> </div> </div>'),
a.put("views/norssit.table.partial.html",'<table class="table table-striped norssi-table ng-table-responsive" ng-table="vm.tableParams"> <thead> <tr> <th class="col-xs-4">Nimi</th> <th class="col-xs-1">Norssi</th> <th class="col-xs-1">Linkit</th> <th class="col-xs-3"><span class="hidden-xs hidden-sm">Muuta</span></th> <th class="col-xs-3 hidden-xs hidden-sm">Matrikkeliteksti</th> </tr> </thead> <tbody> <tr ng-show="!vm.isLoadingResults" ng-repeat="person in $data"> <td class="person-image-container" data-title="\'Nimi\'"> <div ng-class="::{ \'name-col col-md-12 col-lg-7\': person.image }"> <b>{{ ::person.registerNumber }}. {{ ::person.givenName }} {{ ::person.familyName }}</b><br> {{ ::person.birthPlace }} <span ng-if="::(person.birthDate || person.deathDate)"> {{ ::person.birthDate || \'?\' | date:\'dd.MM.yyyy\' }} <span ng-if="::person.deathDate">- {{ ::person.deathDate | date:\'dd.MM.yyyy\' }}</span> <br> </span> <span class="icon-menu"> <a title="Avaa matrikkelisivu" href="" ng-click="::vm.openPage(person)"><span class="glyphicon glyphicon-book" aria-hidden="true"></span></a> <a title="Data" class="" ng-href="{{ ::person.id }}"><span class="glyphicon glyphicon-hdd" aria-hidden="true"></span></a> </span> </div> <div ng-if="::&quot;person.image&quot;" class="name-col col-md-12 col-lg-5"> <div ng-repeat="img in ::vm.toArray(person.image)" ng-class="{ \'col-md-12\': ($first && $last), \'col-sm-6\': !($first && $last) }" class="person-img-col vcenter"> <img uib-popover-template="\'views/profile-image-popover.html\'" popover-trigger="\'mouseenter\'" popover-placement="auto right" popover-append-to-body="true" class="person-image img img-responsive" ng-src="{{ img  }}"> </div> </div> </td> <td data-title="\'Norssi\'"> {{ ::person.enrollmentYear || \'?\' }} - {{ ::person.matriculationYear || \'?\' }} </td> <td class="links" data-title="\'Linkit\'"> <div ng-if="::person.achievement"> <a href="" uib-popover-template="\'views/achievements-popover.html\'" popover-trigger="\'outsideClick\'" popover-append-to-body="true" popover-placement="auto top">Saavutukset</a> </div> <a class="link" ng-if="::person.wikipedia" ng-href="{{ ::person.wikipedia }}">Wikipedia</a> <a class="link" ng-if="::person.kansallisbiografia" ng-href="{{ ::person.kansallisbiografia }}">Kansallisbiografia</a> <a class="link" ng-if="::person.warsa" ng-href="http://www.sotasampo.fi/fi/persons/?uri={{ ::person.warsa }}">Sotasampo</a> <a class="link" ng-if="::person.kirjasampo" ng-href="{{ ::person.kirjasampo }}">Kirjasampo</a> <a class="link" ng-if="::person.kulttuurisampo" ng-href="{{ ::person.kulttuurisampo }}">Kulttuurisampo</a> <a class="link" ng-if="::person.blf" ng-href="{{ ::person.blf }}">BLF</a> <a class="link" ng-if="::person.ulan" ng-href="{{ ::person.ulan }}">ULAN</a> <a class="link" ng-if="::person.viaf" ng-href="{{ ::person.viaf }}">VIAF</a> <a class="link" ng-if="::person.genicom" ng-href="{{ ::person.genicom }}">Kotisivu (Geni.com)</a> <a class="link" ng-if="::person.genitree" ng-href="{{ ::person.genitree }}">Sukupuu (Geni.com)</a> </td> <td data-title="\'Muuta\'"> <div ng-if="::person.relative"> <span>Sukulaiset: </span><br> <span ng-repeat="relative in vm.toArray(person.relative)"> {{ ::relative.type }}<a ng-href="{{ ::relative.id }}"> {{ ::relative.name }}</a><br> </span> </div> <button class="page-btn visible-xs-block visible-sm-block btn btn-default" ng-click="::vm.openPage(person)">Matrikkelisivu</button> <div ng-if="::person.hobby"><span>Harrastukset: </span><br>{{ ::person.hobby | join:\', \' }}</div> <button class="page-btn visible-xs-block visible-sm-block btn btn-default" ng-click="::vm.openPage(person)">Matrikkelisivu</button> </td> <td data-title="\'Matrikkeliteksti\'" class="hidden-xs hidden-sm" uib-popover-template="\'views/register-text-popover.html\'" popover-trigger="\'mouseenter\'" popover-append-to-body="true" popover-placement="auto left">{{ ::person.entryText | truncate: 500 : \'...\' : true }}</td> </tr> </tbody> </table> <img class="loading-img" src="images/loading-lg.7ba320e0.gif" ng-if="vm.isLoadingResults">'),a.put("views/norssit.visu.html",'<div class="container-fluid"> <div class="row"> <div class="col-md-1 col-sm-2 col-xs-2 vcenter push-xs-2"> <img src="http://www.norssit.fi/images/norssi_logo.jpg" class="norssi-logo center-block img img-responsive"> </div><!-- DO NOT REMOVE THIS COMMENT, IT IS A HACK\n --><div class="col-xs-9 col-md-8 col-lg-9 vcenter push-xs-9"> <div ng-include="\'views/norssit.description.partial.html\'"></div> </div> <div class="col-md-3 pull-md-3 col-lg-2"> <div ng-include="\'views/norssit.facets.partial.html\'"></div> </div> <div class="col-md-9 col-lg-10" min-height="500"> <img class="loading-img" src="images/loading-lg.7ba320e0.gif" ng-if="vm.isLoadingResults"> <div id="chart_occupation" style="width: 100%; height: 500px"></div> <div id="chart_education" style="width: 100%; height: 500px"></div> <div id="chart_organization" style="width: 100%; height: 500px"></div> <div id="chart_enrollmentYear"></div> <div id="chart_matriculationYear"></div> <div id="chart_topeducation" style="width: 100%; height: 500px"></div> <div id="chart_toporganization" style="width: 100%; height: 500px"></div> <div id="chart_sankey" style="width: 100%; height: 700px"></div> <!-- <div id="chart_hobbies" style="width: 100%; height: 500px;"></div>\n         <div id="chart_birthPlace" style="width: 100%; height: 500px;"></div> --> </div> </div> </div>'),a.put("views/page-modal.html",'<div class="modal-header"> <div class="row"> <div class="col-xs-8"> <h3 class="modal-title">{{ $ctrl.person.ordinal }} {{ $ctrl.person.givenName }} {{ $ctrl.person.familyName }}</h3> </div> <div class="col-xs-4 text-right"> <button class="btn btn-default" ng-click="$ctrl.previousPage()" ng-disabled="$ctrl.pageNo === 1" aria-label="Edellinen sivu"> <span class="glyphicon glyphicon-step-backward"></span> </button> <span>{{ $ctrl.pageNo }}</span> <button class="btn btn-default" ng-click="$ctrl.nextPage()" ng-disabled="$ctrl.pageNo === 716" aria-label="Seuraava sivu"> <span class="glyphicon glyphicon-step-forward"></span> </button> <button ng-click="$ctrl.close()" class="btn btn-default" aria-label="Sulje"> <span aria-hidden="true" class="glyphicon glyphicon-remove"></span> </button> </div> </div> </div><div class="modal-body"> <img class="img img-responsive" ng-src="{{ $ctrl.pageUrl }}"> </div>'),a.put("views/profile-image-popover.html",'<div> <img class="img img-responsive" ng-src="{{ img }}"> </div>'),a.put("views/register-text-popover.html","<div> <pre>{{ person.entryText }}</pre> </div>"),a.put("views/subnavbar.html",'<ul class="nav navbar-nav"> <li><a href="" id="show-help" ng-click="vm.showHelp()"><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> Ohje</a></li> <li ui-sref-active="active"><a ui-sref="list"><span class="glyphicon glyphicon-th" aria-hidden="true"></span> Lista</a></li> <li ui-sref-active="active"><a ui-sref="table"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span> Taulukko</a></li> <li ui-sref-active="active"><a ui-sref="visu"><span class="glyphicon glyphicon-stats" aria-hidden="true"></span> Visualisointi</a></li> </ul>')}]);